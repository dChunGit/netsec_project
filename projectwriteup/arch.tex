Our tool will scan the network for vulnerable IPs by fingerprinting each OS, firstly by http header and secondly via methods including a TCP/IP/SYN method described by Han and Du (2010)~\cite{han_du_2010}. RDP requires port 3389 to be open, so we proceed by filtering for this open port. Once complete, the final step is to scan the filtered hosts for the BlueKeep vulnerability. This scan can consist of detecting that RDP is running and then attempting a request/response comparison to check if the vulnerability has been patched or not.

The patch scan works by checking the response to a specially crafted packet, which will differ if the host is safe or vulnerable. The scanner first authenticates with the host via a handshake protocol and connects to the MS\_T120 channel. Once we send a close channel command with a specified size, there are two possible outcomes. On a vulnerable machine, the host will close the channel properly, sending a disconnect packet. However, on a patched machine, the channel will not close and no disconnect packet is sent. Thus by waiting for a couple seconds, we can determine if the host has been patched or not~\cite{dillon_2019}.

Once we have detected a BlueKeep vulnerable machine, we then proceed to extract holistic data about our targets, including OS version, other open ports, geographic location, among others using Whois and other network tools. This data can then be used to aggregate common environment or network features which could give insight into the applicability, danger, and relevancy of BlueKeep.

The test setup for scanning BlueKeep vulnerable machines includes 4 steps. First, we use scapy to send a SYN packet to a set of IP addresses, looking for an open port 3389. Once we have filtered down to only a subset of the original IPs, we then use the SYN packet and the SYN/ACK reply to fingerprint the OS at the host IP address. While there are several ways of doing so, we are utilizing a passive os fingerprinting method via scapy's p0f methods rather than an active implementation both for better accuracy as well as for simplicity. The key metrics are IP initial TTL and particularly TCP window size. Table 1 shows several examples of how these can be used to fingerprint - they both can vary widely by OS and thus are good candidates for filtering. Finally, once these candidate IPs have been identified, we will run the patch scan described above to detect whether they are truly vulnerable to the BlueKeep CVE. Those that are vulnerable proceed to our last stage where we collect data using Whois.